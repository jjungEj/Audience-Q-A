<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AX Q&A PoC</title>
<!-- Favicon 추가 -->
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>💬</text></svg>">
<style>
  :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',Arial;}
  body{margin:0;background:#f6f7fb;color:#111}
  .wrap{max-width:480px;margin:0 auto;padding:16px}
  header{display:flex;gap:8px;align-items:center;justify-content:space-between}
  h1{font-size:18px;margin:0}
  .card{display:block;background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(10,20,50,.06);margin-top:12px}
  .hidden{display:none}
  input,button,textarea{font-size:15px;padding:10px;border-radius:8px;border:1px solid #e3e6ef;width:100%;box-sizing:border-box}
  .row{display:flex;gap:8px}
  .half{flex:1}
  .small{font-size:13px;color:#666;margin-top:6px}
  .btn{background:#3b82f6;color:#fff;border:0;padding:10px;border-radius:8px;cursor:pointer}
  .btn.ghost{background:#fff;color:#333;border:1px solid #e3e6ef}
  .btn.red{background:#ef4444;color:#fff;border:0}
  .room-info{display:flex;flex-direction:column;gap:8px;margin-top:8px}
  .qr{background:#fff;padding:8px;border-radius:8px;text-align:center}
  .question{background:#fff;padding:10px;border-radius:10px;margin-top:8px;display:flex;justify-content:space-between;align-items:flex-start;gap:8px; border: 1px solid #111;}
  .q-left{flex:1}
  .meta{font-size:12px;color:#666;margin-top:6px;display:flex;gap:8px;align-items:center}
  .like{background:#eef2ff;color:#3730a3;padding:6px 8px;border-radius:8px;border:0;cursor:pointer}
  .pinned{background:#fffbe6;border:1px solid #ffd666}
  .topbar{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;}
  .link-box{background:#f1f5f9;padding:8px;border-radius:8px;font-size:13px;overflow-wrap:anywhere}
  footer{margin:20px 0;text-align:center;font-size:12px;color:#888}
  .my-rooms-list .room-item{display:flex;justify-content:space-between;align-items:center;padding:10px;margin-top:8px;border:1px solid #111;border-radius:8px;background:#fff;}
  .my-rooms-list .room-item button{width:auto;margin-left:8px;padding:6px 10px;font-size:13px}
  .question > div:last-child {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: 6px;
  }
  .question.pinned > div:last-child {
    flex-direction: row;
    align-items: center;
  }
  .room-info {
    background-color: transparent;
    border: none;
    padding: 0;
  }
  .my-rooms-list .room-item > div:first-child {
    background-color: transparent;
    border: none;
    padding: 0;
  }
  /* 메시지 박스 스타일 추가 */
  #messageBox {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    padding: 24px;
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0,0,0,.15);
    z-index: 1000;
    text-align: center;
    max-width: 300px;
    transition: opacity 0.3s ease-in-out;
  }
  #messageBox h4 {
    margin: 0 0 12px;
  }
  #messageBox p {
    margin: 0;
  }
  .fade-out {
    opacity: 0;
  }
  @media(min-width:520px){body{background:#eef2f9}}
</style>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
</head>
<body>
<div class="wrap">
  <header>
    <h1>AX Q&A PoC</h1>
    <div id="roleTag"></div>
  </header>

  <div id="loginCard" class="card">
    <h3>로그인</h3>
    <div>
      <label>아이디</label><input id="inputId" placeholder="아이디" />
    </div>
    <div style="margin-top:8px">
      <label>비밀번호</label><input id="inputPw" placeholder="비밀번호" type="password" />
    </div>
    <div class="row" style="margin-top:10px">
      <button id="btnLogin" class="btn half">로그인</button>
      <button id="btnGotoSignup" class="btn ghost half">회원가입</button>
    </div>
    <div class="row" style="margin-top:10px">
        <button id="btnJoinRoom" class="btn half">방 코드로 접속</button>
    </div>
  </div>

  <div id="signupCard" class="card hidden">
    <h3>회원가입</h3>
    <div>
      <label>아이디</label><input id="signupId" placeholder="아이디" />
    </div>
    <div style="margin-top:8px">
      <label>비밀번호</label><input id="signupPw" placeholder="비밀번호" type="password" />
    </div>
    <div style="margin-top:8px">
      <label>이름</label><input id="signupName" placeholder="표시될 이름" />
    </div>
    <div class="row" style="margin-top:10px">
      <button id="btnSignup" class="btn half">가입하기</button>
      <button id="btnCancelSignup" class="btn ghost half">취소</button>
    </div>
  </div>

  <div id="joinRoomCard" class="card hidden">
    <h3>방 코드로 접속</h3>
    <div>
      <label>방 코드</label><input id="roomCodeInput" placeholder="방 코드 (예: r123abc)" />
    </div>
    <div class="row" style="margin-top:10px">
      <button id="joinRoomBtn" class="btn half">입장</button>
      <button id="cancelJoin" class="btn ghost half">취소</button>
    </div>
  </div>

  <div id="dash" class="hidden">
    <div class="topbar">
      <button id="btnCreateRoom" class="btn">새로운 Q&A 생성</button>
      <button id="btnLogout" class="btn ghost">로그아웃</button>
    </div>
    <div id="myInfo" class="small"></div>
    <h3 style="margin-top:20px">나의 질문방</h3>
    <div id="myRoomsList" class="my-rooms-list"></div>
  </div>

  <div id="createRoomCard" class="card hidden">
    <h3>방 생성</h3>
    <div style="margin-top:8px">
      <label>방 제목</label><input id="roomTitle" placeholder="최대 20글자" maxlength="20" />
    </div>
    <div class="row" style="margin-top:10px">
      <button id="createRoomBtn" class="btn half">생성</button>
      <button id="cancelCreate" class="btn ghost half">취소</button>
    </div>
  </div>

  <div id="roomCard" class="card hidden">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <strong id="roomTitleView"></strong>
        <div class="small" id="roomMeta"></div>
      </div>
    </div>
    
    <div id="presenterControls" class="hidden" style="margin-top:12px">
      <div class="small">질문 개수 <span id="qCount">0</span></div>
      <div class="qr" style="display:flex;flex-direction:column;align-items:center;gap:8px">
        <canvas id="qrcode"></canvas>
        <div class="small">QR코드를 스캔하거나, 아래 코드로 접속하세요.</div>
        <div style="font-size:18px;font-weight:600;color:#333" id="roomCodeDisplay"></div>
      </div>
      <!-- 발표자용 '나가기' 버튼 추가 -->
      <div class="row" style="margin-top:10px">
        <button id="presenterBackToDash" class="btn ghost">나가기</button>
      </div>
    </div>

    <div id="askArea" style="margin-top:12px">
      <div id="askForm" class="">
        <textarea id="qText" placeholder="질문을 입력하세요"></textarea>
        <div style="margin-top:8px" class="row">
          <button id="submitQ" class="btn half">제출</button>
          <button id="backToDash" class="btn ghost half">나가기</button>
        </div>
      </div>
    </div>

    <div id="questionsList" style="margin-top:12px"></div>
  </div>

  <!-- 메시지 박스 UI 추가 -->
  <div id="messageBox" class="hidden">
    <h4 id="messageTitle"></h4>
    <p id="messageBody"></p>
    <div id="messageButtons" class="row" style="margin-top: 15px;"></div>
  </div>
  
</div>

<script type="module">
  // Firebase SDKs 가져오기
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getDatabase, ref, set, onValue, remove, get } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

  // 여러분의 웹 앱 Firebase 설정
  const firebaseConfig = {
    apiKey: "AIzaSyCvReaeCxaXtZW9glPcawb-iDN7D2L0cXc",
    authDomain: "qawlf-f2041.firebaseapp.com",
    projectId: "qawlf-f2041",
    storageBucket: "qawlf-f2041.firebasestorage.app",
    messagingSenderId: "505520622932",
    appId: "1:505520622932:web:619f946ec6fde6a3340cc1",
    databaseURL: "https://qawlf-f2041-default-rtdb.firebaseio.com"
  };

  // Firebase 초기화
  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // 간단 유틸
  const qs = (s, el=document) => el.querySelector(s);
  const qsa = (s, el=document) => Array.from(el.querySelectorAll(s));
  const uid = () => 'r'+Math.random().toString(36).slice(2,9);

  // 상태
  let user = null;
  let currentRoom = null;
  const LS_SESSION = 'ax_session';
  const LS_LIKES = 'ax_likes';

  // 세션 저장 및 로드
  async function saveSession(u){
    localStorage.setItem(LS_SESSION, JSON.stringify(u));
    user=u;
    renderInitial();
    // 로그인 후 바로 대시보드를 렌더링하기 위해 방 목록을 가져옵니다.
    const snapshot = await get(ref(db, 'rooms'));
    const rooms = snapshot.val() || {};
    renderDashboard(rooms);
  }

  function clearSession(){ 
    localStorage.removeItem(LS_SESSION); 
    user=null; 
    currentRoom=null; 
    renderInitial(); 
  }

  function loadState(){ 
    try{ user = JSON.parse(localStorage.getItem(LS_SESSION)); }catch(e){user=null;}
    renderInitial();
  }
  
  // 메시지 및 확인 기능 (모든 팝업 제거)
  function showMessage(title, message){
    const messageBox = qs('#messageBox');
    const messageButtons = qs('#messageButtons');
    qs('#messageTitle').textContent = title;
    qs('#messageBody').textContent = message;
    messageButtons.innerHTML = '';
    
    // 단순 메시지 팝업에는 확인 버튼만 추가
    const okBtn = document.createElement('button');
    okBtn.className = 'btn half';
    okBtn.textContent = '확인';
    okBtn.onclick = () => messageBox.classList.add('hidden');
    messageButtons.appendChild(okBtn);

    messageBox.classList.remove('hidden');
  }

  function showConfirmation(title, message, onConfirm) {
    const messageBox = qs('#messageBox');
    const messageButtons = qs('#messageButtons');
    qs('#messageTitle').textContent = title;
    qs('#messageBody').textContent = message;
    messageButtons.innerHTML = '';
    
    const confirmBtn = document.createElement('button');
    confirmBtn.className = 'btn half red';
    confirmBtn.textContent = '예';
    confirmBtn.onclick = () => {
      onConfirm();
      messageBox.classList.add('hidden');
    };

    const cancelBtn = document.createElement('button');
    cancelBtn.className = 'btn half ghost';
    cancelBtn.textContent = '아니오';
    cancelBtn.onclick = () => messageBox.classList.add('hidden');

    messageButtons.appendChild(confirmBtn);
    messageButtons.appendChild(cancelBtn);

    messageBox.classList.remove('hidden');
  }
  
  // Firebase DB에서 데이터 가져오기 (실시간 리스너)
  function listenToRooms() {
    onValue(ref(db, 'rooms'), (snapshot) => {
      const rooms = snapshot.val() || {};
      if (currentRoom) {
        const room = rooms[currentRoom];
        if (room) {
          renderQuestions(room);
        } else {
          currentRoom = null;
          showCard('dash');
        }
      }
      if (user) {
        renderDashboard(rooms);
      }
    });
  }

  // 룸/데이터 helpers
  function saveRoom(room){
    set(ref(db, 'rooms/' + room.id), room);
  }

  function createRoom(title, owner){
    const id = uid();
    const newRoom = {id,title,owner,created:Date.now(),questions:[],pinned:[]};
    set(ref(db, 'rooms/' + id), newRoom);
    return id;
  }

  function getRoom(id, rooms){
    return rooms[id] || null;
  }

  // deleteRoom 함수에서 확인 창 제거
  function deleteRoom(roomId){
    remove(ref(db, 'rooms/' + roomId));
    if(currentRoom === roomId){
        currentRoom = null;
        showCard('dash');
    }
  }

  // 방 표시
  function showRoom(id){
    get(ref(db, 'rooms/' + id)).then((snapshot) => {
      const room = snapshot.val();
      if(!room){
        showMessage('오류', '방이 없습니다.');
        return;
      }
      showCard('roomCard');
      qs('#roomTitleView').textContent = room.title;
      qs('#roomMeta').textContent = '방ID: '+room.id+' • 생성자: '+room.owner;
      
      // 발표자 제어 노출 여부
      if(user && user.id === room.owner){
        qs('#presenterControls').classList.remove('hidden');
        qs('#askArea').classList.add('hidden');
        qs('#roleTag').textContent = '발표자';
        generateQR(room.id);
      } else {
        qs('#presenterControls').classList.add('hidden');
        qs('#askArea').classList.remove('hidden');
        qs('#roleTag').textContent = '게스트';
      }
      renderQuestions(room);
    });
  }

  // QR 코드 생성
  function generateQR(roomId) {
    const url = `https://jjungej.github.io/Audience-Q-A/?room=${roomId}`;
    
    const canvas = qs('#qrcode');
    
    // 이전에 생성된 QR코드가 있으면 제거
    const context = canvas.getContext('2d');
    context.clearRect(0, 0, canvas.width, canvas.height);

    QRCode.toCanvas(canvas, url, {
        width: 120,
        height: 120
    }, function (error) {
        if (error) console.error(error);
    });
    
    qs('#roomCodeDisplay').textContent = roomId;
  }
  
  // 질문 리스트 렌더
  function renderQuestions(room){
    const qCountElement = qs('#qCount');
    if (qCountElement) {
        qCountElement.textContent = (room.questions || []).length;
    }

    const pinnedSet = new Set(room.pinned || []);
    const pinned = (room.questions || []).filter(q=>pinnedSet.has(q.id));
    const others = (room.questions || []).filter(q=>!pinnedSet.has(q.id));
    others.sort((a,b)=> b.likes - a.likes || b.created - a.created);
    const list = [...pinned.map(q=>({...q,pinned:true})), ...others];
    const container = qs('#questionsList');
    container.innerHTML = '';
    list.forEach(q=>{
      const div = document.createElement('div');
      div.className = 'question' + (q.pinned? ' pinned':'');
      div.innerHTML = `
        <div class="q-left">
          <div style="font-weight:600">${escapeHtml(q.text)}</div>
          <div class="meta">${escapeHtml(q.author)} • ${new Date(q.created).toLocaleTimeString()}</div>
        </div>
        <div class="q-actions">
          ${ (user && user.id===room.owner) ? `<button class="btn ghost pinBtn" data-id="${q.id}">📌</button>` : '' }
          <button class="like" data-id="${q.id}">👍<span class="count">${q.likes}</span></button>
        </div>
      `;
      container.appendChild(div);
    });

    // 이벤트 바인딩: 좋아요
    qsa('.like', container).forEach(btn=>{
      btn.onclick = ()=>{
        const id = btn.dataset.id;
        handleLike(room.id,id);
      };
    });
      // pin buttons
    qsa('.pinBtn', container).forEach(b=>{
      b.onclick = ()=>{
        const id = b.dataset.id;
        togglePin(room.id,id);
      };
    });
  }

  // 좋아요 처리 (클라이언트 로컬 기반: 사용자별 liked 기록을 localStorage per-session)
  function handleLike(roomId, qId) {
    get(ref(db, 'rooms/' + roomId)).then((snapshot) => {
        const room = snapshot.val();
        if (!room) return;

        const sessionLikesKey = LS_LIKES + '_' + (user ? user.id : 'guest');
        const likedQuestions = JSON.parse(localStorage.getItem(sessionLikesKey) || '[]');
        
        const q = (room.questions || []).find(x => x.id === qId);
        if (!q) return;

        const likeIndex = likedQuestions.indexOf(qId);
        if (likeIndex > -1) {
            // 이미 좋아요를 누른 경우, 좋아요 취소
            likedQuestions.splice(likeIndex, 1);
            q.likes = Math.max(0, (q.likes || 0) - 1); // 좋아요 수를 0 미만으로 내려가지 않게 함
            showMessage('알림', '좋아요가 취소되었습니다.');
        } else {
            // 좋아요를 누르지 않은 경우, 좋아요 추가
            likedQuestions.push(qId);
            q.likes = (q.likes || 0) + 1;
            showMessage('알림', '좋아요를 눌렀습니다.');
        }

        localStorage.setItem(sessionLikesKey, JSON.stringify(likedQuestions));
        saveRoom(room);
    });
  }


  function togglePin(roomId,qId){
    get(ref(db, 'rooms/' + roomId)).then((snapshot) => {
      const room = snapshot.val();
      if(!room) return;
      room.pinned = room.pinned || [];
      if(room.pinned.includes(qId)){
        room.pinned = room.pinned.filter(x=>x!==qId);
      } else {
        room.pinned.push(qId);
      }
      saveRoom(room);
    });
  }

  // 발표자 대시보드 렌더링
  function renderDashboard(allRooms){
    const myRooms = Object.values(allRooms).filter(r => user && r.owner === user.id);
    const container = qs('#myRoomsList');
    container.innerHTML = '';
    if(myRooms.length === 0){
      container.innerHTML = '<p class="small">생성된 질문방이 없습니다.</p>';
    } else {
      myRooms.forEach(room => {
        const item = document.createElement('div');
        item.className = 'room-item';
        item.innerHTML = `
          <div>
            <strong>${escapeHtml(room.title)}</strong>
            <div class="small">ID: ${room.id}</div>
          </div>
          <div>
            <button data-id="${room.id}" class="btn half enter-my-room">입장</button>
            <button data-id="${room.id}" class="btn ghost red delete-my-room">삭제</button>
          </div>
        `;
        container.appendChild(item);
      });
      qsa('.enter-my-room').forEach(btn => {
        btn.onclick = () => {
          const id = btn.dataset.id;
          currentRoom = id;
          showRoom(id);
        };
      });
      qsa('.delete-my-room').forEach(btn => {
        btn.onclick = () => {
          const id = btn.dataset.id;
          showConfirmation('방 삭제', '삭제 시 좋아요, 고정, 질문들까지 모두 삭제됩니다. 정말 삭제하시겠습니까?', () => deleteRoom(id));
        };
      });
    }
  }

  // 간단 카드 전환
  function showCard(id){
    ['loginCard','dash','createRoomCard','roomCard', 'joinRoomCard', 'signupCard'].forEach(x=>{
      const element = qs('#'+x);
      if (element) {
        element.classList.add('hidden');
      }
    });
    const targetElement = qs('#'+id);
    if (targetElement) {
      targetElement.classList.remove('hidden');
    }
  }

  // 기본 렌더링
  function renderInitial(){
    if(!user){
      showCard('loginCard');
      qs('#roleTag').textContent = '';
      qs('#myInfo').textContent = '';
    } else {
      showCard('dash');
      qs('#myInfo').textContent = `로그인: ${user.name} (${user.id})`;
    }
  }

  // URL 파라미터로 바로 입장
  function tryEnterFromUrl(){
    const p = new URLSearchParams(location.search);
    const r = p.get('room');
    if(r){
      get(ref(db, 'rooms/' + r)).then((snapshot) => {
        const room = snapshot.val();
        if(room){
          currentRoom = r;
          showRoom(r);
        }
      });
    }
  }

  // Helpers
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c]); }

  function startApp() {
    // 로그인 버튼 이벤트 리스너 (기존 계정 로그인만 담당)
    qs('#btnLogin').addEventListener('click', ()=>{
      const id = qs('#inputId').value.trim();
      const pw = qs('#inputPw').value.trim();
      if(!id || !pw){ 
        showMessage('오류', '아이디와 비밀번호를 입력해주세요.'); 
        return; 
      }
      
      get(ref(db, 'users/' + id)).then((snapshot) => {
          if (snapshot.exists()) {
              const existingUser = snapshot.val();
              if (existingUser.pw === pw) {
                  saveSession({id, pw, name: existingUser.name});
                  showMessage('알림', '로그인 성공!');
              } else {
                  showMessage('오류', '아이디 또는 비밀번호가 올바르지 않습니다.');
              }
          } else {
              showMessage('오류', '존재하지 않는 아이디입니다.');
          }
      }).catch(error => {
          showMessage('오류', '로그인 중 오류가 발생했습니다.');
          console.error("Authentication error: ", error);
      });
    });

    // 회원가입 버튼 이벤트 리스너
    qs('#btnSignup').addEventListener('click', ()=>{
      const id = qs('#signupId').value.trim();
      const pw = qs('#signupPw').value.trim();
      const name = qs('#signupName').value.trim() || id;

      if (!id || !pw) {
        showMessage('오류', '아이디와 비밀번호를 입력해주세요.');
        return;
      }

      get(ref(db, 'users/' + id)).then((snapshot) => {
        if (snapshot.exists()) {
          showMessage('오류', '이미 존재하는 아이디입니다.');
        } else {
          set(ref(db, 'users/' + id), { id, pw, name })
            .then(() => {
              saveSession({ id, pw, name });
              showMessage('알림', '회원가입 완료! 로그인되었습니다.');
            })
            .catch(error => {
              showMessage('오류', '계정 생성 중 오류가 발생했습니다.');
              console.error("Error creating user: ", error);
            });
        }
      });
    });

    // 화면 전환 버튼 리스너
    qs('#btnGotoSignup').addEventListener('click', () => { showCard('signupCard'); });
    qs('#btnCancelSignup').addEventListener('click', () => { showCard('loginCard'); });
    
    // 로그아웃 버튼을 누르면 즉시 세션 초기화
    qs('#btnLogout').addEventListener('click', ()=>clearSession());

    qs('#btnJoinRoom').addEventListener('click', ()=>{ showCard('joinRoomCard'); });
    qs('#cancelJoin').addEventListener('click', ()=>{ showCard('loginCard'); });
    qs('#joinRoomBtn').addEventListener('click', ()=>{
      const roomCode = qs('#roomCodeInput').value.trim();
      if(!roomCode){
          showMessage('오류', '방 코드를 입력해주세요.');
          return;
      }
      get(ref(db, 'rooms/' + roomCode)).then((snapshot) => {
          const room = snapshot.val();
          if(room){
              currentRoom = roomCode;
              showRoom(roomCode, snapshot.val());
          } else {
              showMessage('오류', '해당하는 방 코드가 없습니다.');
          }
      });
    });

    qs('#btnCreateRoom').addEventListener('click', ()=>{
      qs('#roomTitle').value = ''; // 방 제목 입력창 초기화
      showCard('createRoomCard');
    });
    qs('#cancelCreate').addEventListener('click', ()=>{ showCard('dash'); });
    qs('#createRoomBtn').addEventListener('click', ()=>{
      const title = qs('#roomTitle').value.trim() || (user? user.name+'의 방' : '익명의 방');
      const id = createRoom(title, user?user.id:'guest');
      currentRoom = id;
      showRoom(id);
    });
    
    // 발표자와 게스트 모두에게 적용될 '나가기' 버튼 이벤트 리스너
    const backToDashHandler = () => {
      currentRoom = null;
      if (user) {
          showCard('dash');
      } else {
          showCard('loginCard');
      }
    };

    qs('#backToDash').addEventListener('click', backToDashHandler);
    qs('#presenterBackToDash').addEventListener('click', backToDashHandler);

    qs('#submitQ').addEventListener('click', ()=>{
      const txt = qs('#qText').value.trim();
      if(!txt){ showMessage('오류', '질문 내용을 입력하세요.'); return; }
      get(ref(db, 'rooms/' + currentRoom)).then((snapshot) => {
        const room = snapshot.val();
        if(!room) return;
        const q = {id:uid(), text:txt, author: user? user.name : '익명', likes:0, likedBy:[], created:Date.now()};
        room.questions = room.questions || [];
        room.questions.push(q);
        saveRoom(room);
        qs('#qText').value='';
      });
    });

    // 질문 텍스트 상자 높이 자동 조절 기능
    const qTextarea = qs('#qText');
    qTextarea.addEventListener('input', () => {
      qTextarea.style.height = 'auto';
      qTextarea.style.height = qTextarea.scrollHeight + 'px';
    });
  }
  
  window.onload = function() {
      loadState();
      listenToRooms();
      tryEnterFromUrl();
      startApp();
  };
</script>
</body>
</html>
