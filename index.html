
<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AX Q&A PoC</title>
<style>
  :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans KR',Arial;}
  body{margin:0;background:#f6f7fb;color:#111}
  .wrap{max-width:480px;margin:0 auto;padding:16px}
  header{display:flex;gap:8px;align-items:center;justify-content:space-between}
  h1{font-size:18px;margin:0}
  card{display:block;background:#fff;padding:12px;border-radius:10px;box-shadow:0 6px 18px rgba(10,20,50,.06);margin-top:12px}
  .hidden{display:none}
  input,button,textarea{font-size:15px;padding:10px;border-radius:8px;border:1px solid #e3e6ef;width:100%;box-sizing:border-box}
  .row{display:flex;gap:8px}
  .half{flex:1}
  .small{font-size:13px;color:#666;margin-top:6px}
  .btn{background:#3b82f6;color:#fff;border:0;padding:10px;border-radius:8px}
  .btn.ghost{background:#fff;color:#333;border:1px solid #e3e6ef}
  .room-info{display:flex;flex-direction:column;gap:8px;margin-top:8px}
  .qr{background:#fff;padding:8px;border-radius:8px;text-align:center}
  .question{background:#fff;padding:10px;border-radius:10px;margin-top:8px;display:flex;justify-content:space-between;align-items:flex-start;gap:8px}
  .q-left{flex:1}
  .meta{font-size:12px;color:#666;margin-top:6px;display:flex;gap:8px;align-items:center}
  .like{background:#eef2ff;color:#3730a3;padding:6px 8px;border-radius:8px;border:0;cursor:pointer}
  .pinned{background:#fffbe6;border:1px solid #ffd666}
  .topbar{display:flex;gap:8px;margin-top:10px}
  .link-box{background:#f1f5f9;padding:8px;border-radius:8px;font-size:13px;overflow-wrap:anywhere}
  footer{margin:20px 0;text-align:center;font-size:12px;color:#888}
  @media(min-width:520px){body{background:#eef2f9}}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>AX Q&A PoC</h1>
    <div id="roleTag"></div>
  </header>

  <!-- ë¡œê·¸ì¸ -->
  <div id="loginCard" class="card">
    <div>
      <label>ì•„ì´ë””</label><input id="inputId" placeholder="ì•„ì´ë””" />
    </div>
    <div style="margin-top:8px">
      <label>ë¹„ë°€ë²ˆí˜¸</label><input id="inputPw" placeholder="ë¹„ë°€ë²ˆí˜¸" type="password" />
    </div>
    <div style="margin-top:8px">
      <label>ì´ë¦„</label><input id="inputName" placeholder="í‘œì‹œë  ì´ë¦„" />
    </div>
    <div class="row" style="margin-top:10px">
      <button id="btnLogin" class="btn half">ë¡œê·¸ì¸</button>
    </div>
  </div>

  <!-- ëŒ€ì‹œë³´ë“œ -->
  <div id="dash" class="hidden">
    <div class="topbar">
      <button id="btnCreateRoom" class="btn">ë°© ìƒì„±(ë°œí‘œì)</button>
      <button id="btnEnterRoom" class="btn ghost">ë°© ì…ì¥(ì²­ì¤‘)</button>
      <button id="btnLogout" class="btn ghost">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
    <div id="myInfo" class="small"></div>
  </div>

  <!-- ë°œí‘œì: ë°© ìƒì„± -->
  <div id="createRoomCard" class="card hidden">
    <h3>ë°© ìƒì„±</h3>
    <div style="margin-top:8px">
      <label>ë°© ì œëª©</label><input id="roomTitle" placeholder="ì˜ˆ: 2ë¶„ê¸° ì‚¬ì—… ì—…ë°ì´íŠ¸" />
    </div>
    <div class="row" style="margin-top:10px">
      <button id="createRoomBtn" class="btn half">ìƒì„±</button>
      <button id="cancelCreate" class="btn ghost half">ì·¨ì†Œ</button>
    </div>
  </div>

  <!-- ë°© í™”ë©´(ë°œí‘œì/ì²­ì¤‘ ê³µí†µ) -->
  <div id="roomCard" class="card hidden">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <strong id="roomTitleView"></strong>
        <div class="small" id="roomMeta"></div>
      </div>
      
    </div>

    <div id="presenterControls" class="hidden" style="margin-top:12px">
      <div class="small">ì§ˆë¬¸ ê°œìˆ˜ <span id="qCount">0</span></div>
    </div>

    <div id="askArea" style="margin-top:12px">
      <div id="askForm" class="">
        <textarea id="qText" rows="3" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        <div style="margin-top:8px" class="row">
          <button id="submitQ" class="btn half">ì œì¶œ</button>
          <button id="backToDash" class="btn ghost half">ë‚˜ê°€ê¸°</button>
        </div>
      </div>
    </div>

    <div id="questionsList" style="margin-top:12px"></div>
  </div>

  
</div>

<script>
  // ê°„ë‹¨ ìœ í‹¸
  const qs = (s, el=document) => el.querySelector(s);
  const qsa = (s, el=document) => Array.from(el.querySelectorAll(s));
  const uid = () => 'r'+Math.random().toString(36).slice(2,9);

  // ìƒíƒœ
  let user = null; // {id,pw,name}
  let currentRoom = null; // roomId
  // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í‚¤
  const LS_USERS = 'ax_users';
  const LS_ROOMS = 'ax_rooms';
  const LS_SESSION = 'ax_session';

  // ì´ˆê¸°í™”
  function loadState(){ 
    try{ user = JSON.parse(localStorage.getItem(LS_SESSION)); }catch(e){user=null;}
    renderInitial();
  }

  function saveSession(u){ localStorage.setItem(LS_SESSION, JSON.stringify(u)); user=u; renderInitial(); }
  function clearSession(){ localStorage.removeItem(LS_SESSION); user=null; currentRoom=null; renderInitial(); }

  // ë£¸/ë°ì´í„° helpers
  function loadRooms(){ return JSON.parse(localStorage.getItem(LS_ROOMS) || '{}'); }
  function saveRooms(r){ localStorage.setItem(LS_ROOMS, JSON.stringify(r)); }

  function createRoom(title, owner){
    const rooms = loadRooms();
    const id = uid();
    rooms[id] = {id,title,owner,created:Date.now(),questions:[],pinned:[]};
    saveRooms(rooms);
    return id;
  }

  function getRoom(id){
    return loadRooms()[id] || null;
  }

  function saveRoom(room){
    const rooms = loadRooms();
    rooms[room.id] = room;
    saveRooms(rooms);
  }

  // ë¡œê·¸ì¸
  qs('#btnLogin').addEventListener('click', ()=>{
    const id = qs('#inputId').value.trim();
    const pw = qs('#inputPw').value.trim();
    const name = qs('#inputName').value.trim() || id;
    if(!id||!pw){ alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥'); return; }
    // PoC: ì‚¬ìš©ì ì €ì¥(ê°„ë‹¨)
    const users = JSON.parse(localStorage.getItem(LS_USERS)||'{}');
    users[id] = {id,pw,name};
    localStorage.setItem(LS_USERS, JSON.stringify(users));
    saveSession({id,pw,name});
  });

 
  qs('#btnLogout').addEventListener('click', ()=>{ if(confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) clearSession(); });

  // ëŒ€ì‹œë³´ë“œ ë²„íŠ¼
  qs('#btnCreateRoom').addEventListener('click', ()=>{ showCard('createRoomCard'); });
  qs('#cancelCreate').addEventListener('click', ()=>{ showCard('dash'); });
  qs('#createRoomBtn').addEventListener('click', ()=>{
    const title = qs('#roomTitle').value.trim() || (user? user.name+'ì˜ ë°©' : 'ìµëª…ì˜ ë°©');
    const id = createRoom(title, user?user.id:'guest');
    currentRoom = id;
    showRoom(id);
  });

  qs('#btnEnterRoom').addEventListener('click', ()=>{
    const id = prompt('ì…ì¥í•  ë°© IDë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: rxxxxxx)'); if(!id) return;
    const room = getRoom(id);
    if(!room){ alert('í•´ë‹¹ ë°©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; }
    currentRoom = id;
    showRoom(id);
  });

  qs('#backToDash').addEventListener('click', ()=>{ currentRoom=null; showCard('dash'); });

  // ì§ˆë¬¸ ì œì¶œ
  qs('#submitQ').addEventListener('click', ()=>{
    const txt = qs('#qText').value.trim();
    if(!txt){ alert('ì§ˆë¬¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
    const room = getRoom(currentRoom);
    const q = {id:uid(), text:txt, author: user? user.name : 'ìµëª…', likes:0, likedBy:[], created:Date.now()};
    room.questions.push(q);
    saveRoom(room);
    qs('#qText').value='';
    renderQuestions(room);
  });

  // ë°© í‘œì‹œ
  function showRoom(id){
    const room = getRoom(id);
    if(!room){ alert('ë°©ì´ ì—†ìŠµë‹ˆë‹¤'); return; }
    showCard('roomCard');
    qs('#roomTitleView').textContent = room.title;
    qs('#roomMeta').textContent = 'ë°©ID: '+room.id+' â€¢ ìƒì„±ì: '+room.owner;
       // ë°œí‘œì ì œì–´ ë…¸ì¶œ ì—¬ë¶€ (ê°„ë‹¨ íŒë‹¨: ë¡œê·¸ì¸í•œ ì‚¬ìš©ìê°€ ë°© ì†Œìœ ìë©´ ë°œí‘œì)
    if(user && user.id === room.owner){
      qs('#presenterControls').classList.remove('hidden');
      qs('#askForm').classList.add('hidden');
      qs('#roleTag').textContent = 'ë°œí‘œì';
    } else {
      qs('#presenterControls').classList.add('hidden');
      qs('#askForm').classList.remove('hidden');
      qs('#roleTag').textContent = 'ê²ŒìŠ¤íŠ¸';
    }
    renderQuestions(room);
  }

 
  // ì§ˆë¬¸ ë¦¬ìŠ¤íŠ¸ ë Œë”
  function renderQuestions(room){
    qs('#qCount').textContent = room.questions.length;
    // ì •ë ¬: pinned ë¨¼ì € (ìˆœì„œ ìœ ì§€), ê·¸ ë‹¤ìŒ likes desc, ê°™ì€ likes -> ìµœì‹ 
    const pinnedSet = new Set(room.pinned || []);
    const pinned = room.questions.filter(q=>pinnedSet.has(q.id));
    const others = room.questions.filter(q=>!pinnedSet.has(q.id));
    others.sort((a,b)=> b.likes - a.likes || b.created - a.created);
    const list = [...pinned.map(q=>({...q,pinned:true})), ...others];
    const container = qs('#questionsList');
    container.innerHTML = '';
    list.forEach(q=>{
      const div = document.createElement('div');
      div.className = 'question' + (q.pinned? ' pinned':'');
      div.innerHTML = `
        <div class="q-left">
          <div style="font-weight:600">${escapeHtml(q.text)}</div>
          <div class="meta">${escapeHtml(q.author)} â€¢ ${new Date(q.created).toLocaleTimeString()}</div>
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px">
          <button class="like" data-id="${q.id}">ğŸ‘<span class="count">${q.likes}</span></button>
          ${ (user && user.id===room.owner) ? `<button class="btn ghost pinBtn" data-id="${q.id}" style="margin-top:6px">ğŸ“Œ</button>` : '' }
        </div>
      `;
      container.appendChild(div);
    });

    // ì´ë²¤íŠ¸ ë°”ì¸ë”©: ì¢‹ì•„ìš”
    qsa('.like', container).forEach(btn=>{
      btn.onclick = ()=>{
        const id = btn.dataset.id;
        handleLike(room.id,id);
      };
    });
     // pin buttons
    qsa('.pinBtn', container).forEach(b=>{
      b.onclick = ()=>{
        const id = b.dataset.id;
        togglePin(room.id,id);
      };
    });

  }

  // ì¢‹ì•„ìš” ì²˜ë¦¬ (í´ë¼ì´ì–¸íŠ¸ ë¡œì»¬ ê¸°ë°˜: ì‚¬ìš©ìë³„ liked ê¸°ë¡ì„ localStorage per-session)
  function handleLike(roomId,qId){
    const room = getRoom(roomId);
    if(!room) return;
    const sessionLikesKey = 'ax_likes_'+(user?user.id:'guest');
    const liked = JSON.parse(localStorage.getItem(sessionLikesKey)||'[]');
    if(liked.includes(qId)){ alert('ì´ë¯¸ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥´ì…¨ìŠµë‹ˆë‹¤.'); return; }
    // ì¦ê°€
    const q = room.questions.find(x=>x.id===qId);
    if(!q) return;
    q.likes = (q.likes||0)+1;
    q.likedBy = q.likedBy || [];
    q.likedBy.push(user?user.id:'guest');
    saveRoom(room);
    liked.push(qId);
    localStorage.setItem(sessionLikesKey, JSON.stringify(liked));
    renderQuestions(room);
  }

  function togglePin(roomId,qId){
    const room = getRoom(roomId);
    if(!room) return;
    room.pinned = room.pinned || [];
    if(room.pinned.includes(qId)){
      room.pinned = room.pinned.filter(x=>x!==qId);
    } else {
      room.pinned.push(qId);
    }
    saveRoom(room);
    renderQuestions(room);
  }

  // ê°„ë‹¨ ì¹´ë“œ ì „í™˜
  function showCard(id){
    ['loginCard','dash','createRoomCard','roomCard'].forEach(x=>{
      qs('#'+x).classList.add('hidden');
    });
    qs('#'+id).classList.remove('hidden');
  }

  // ê¸°ë³¸ ë Œë”ë§
  function renderInitial(){
    if(!user){
      showCard('loginCard');
      qs('#roleTag').textContent = '';
      qs('#myInfo').textContent = '';
    } else {
      showCard('dash');
      qs('#myInfo').textContent = `ë¡œê·¸ì¸: ${user.name} (${user.id})`;
    }
    qs('#createRoomCard').classList.add('hidden');
    qs('#presenterControls').classList.add('hidden');
    qs('#roomCard').classList.add('hidden');
  }

  // URLì— room íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ ë°”ë¡œ ì…ì¥ ê°€ëŠ¥
  function tryEnterFromUrl(){
    const p = new URLSearchParams(location.search);
    const r = p.get('room');
    if(r){
      const room = getRoom(r);
      if(room){
        currentRoom = r;
        showRoom(r);
      }
    }
  }

  // Helpers
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[c]); }

  // QR SVG generator (very small implementation)
  function qrSvg(text,size=120){
    // For PoC: use simple identicon-like placeholder showing URL text (not a real QR)
    // This keeps code small. In production, integrate a real QR library.
    const short = text.length>24? text.slice(0,24)+'...': text;
    return `<div style="font-size:11px;color:#222">${short}</div><svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
      <rect width="${size}" height="${size}" fill="#fff" rx="8"/>
      <g fill="#111">
        <rect x="8" y="8" width="20" height="20"/>
        <rect x="${size-28}" y="8" width="20" height="20"/>
        <rect x="8" y="${size-28}" width="20" height="20"/>
        <rect x="${Math.floor(size/2)-10}" y="${Math.floor(size/2)-10}" width="20" height="20"/>
      </g>
    </svg>`;
  }

  // ì‹œì‘
  loadState();
  tryEnterFromUrl();



  // í˜ì´ì§€ ë¦¬ë¡œë“œ ê°„ë‹¨í•œ ë™ê¸°í™”: storage ì´ë²¤íŠ¸ë¥¼ ì‚¬ìš©í•´ ë‹¤ë¥¸ íƒ­ ë³€ê²½ ë°˜ì˜
  window.addEventListener('storage', (e)=>{
    if(e.key===LS_ROOMS && currentRoom){
      const r = getRoom(currentRoom);
      if(r) renderQuestions(r);
    }
  });
</script>
</body>
</html>
